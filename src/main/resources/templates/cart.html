<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Cart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script th:src="@{/js/controller.js}"></script>
</head>
<body>

<div th:replace="~{fragments/common :: header}"/>
<div th:replace="~{fragments/common :: heading}"/>

<div class="container">
    <div>
        <a class="btn btn-primary" role="button" th:href="@{/}"/>주문하기</a>
    </div>
    <div style="padding-top:50px">
        <table class="table table-hover">
            <thead>
            <tr>
                <th>도서</th>
                <th>가격</th>
                <th>수량</th>
                <th>소계</th>
                <th>비고</th>
            </tr>
            </thead>
            <tbody>
            <!--1.반복문으로 장바구니에 등록된 도서 정보 목록을 출력.
            커맨드 객체 cart.cartItems를 item 변수로 재정의하여 book 객체, quantity, totlaPrice등을
            ${item.value.필드 이름}을 이용하여 출력 -->
            <form name="removeForm" method="PUT" action="/cart/add/${book.bookId}">
                <tr th:each="item : ${cartItems}">
                    <td th:text="${item.value.book.bookId + '-' + item.value.book.name}"></td>
                    <td th:text="${item.value.book.unitPrice}"></td>
                    <td th:text="${item.value.quantity}"></td>
                    <td th:text="${item.value.totalPrice}"></td>
                    <td>
                        <button th:onclick="'removeFromCart(\'' + '/cart/remove/' + ${item.book.bookId} + '\')'">삭제</button>
                        <button onclick="removeFromCart('/cart/remove/${book.bookId}')">삭제</button>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <th>총액</th>
                    <td th:text="${cart != null ? cart.grandTotal : ''}"></td>
                    <td></td>
                </tr>
            </form>
            </tbody>
        </table>
        <!--2.쇼핑 계속하기 버튼을 작성하고 버튼을 누르면 웹 요청 URL은 /books로 이동 -->
        <a th:href="@{/books}" class="btn btn-secondary">&laquo; 쇼핑 계속하기</a>
    </div>
    <form name="clearForm" method="delete">
        <button onclick="clearCart()" class="btn btn-danger">삭제</button>
    </form>
    <a th:href="@{/order(cartId=${cartId})}" class="btn btn-success float-right">주문하기</a>
</div>

<div th:replace="~{fragments/common :: footer}"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
</body>
</html>